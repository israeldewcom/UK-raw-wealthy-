<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Wealthy - Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent-gold: #f59e0b;
            --accent-emerald: #10b981;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --text-light: #f8fafc;
            --text-muted: #94a3b8;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --radius: 12px;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --gradient-primary: linear-gradient(135deg, #f59e0b, #d97706);
            --gradient-secondary: linear-gradient(135deg, #10b981, #059669);
            --gradient-blue: linear-gradient(135deg, #3b82f6, #2563eb);
            --gradient-purple: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--primary);
            color: var(--text-light);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(251, 191, 36, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-gold);
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9998;
            max-width: 350px;
        }

        .toast {
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            animation: slideInRight 0.3s, slideOutRight 0.5s 2.5s;
            animation-fill-mode: forwards;
            opacity: 0;
            transform: translateX(100%);
        }

        .toast.success { background: var(--success); color: white; }
        .toast.error { background: var(--error); color: white; }
        .toast.warning { background: var(--warning); color: white; }
        .toast.info { background: var(--info); color: white; }

        .toast i { margin-right: 0.5rem; font-size: 1.2rem; }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOutRight {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* Admin Page */
        .admin-page {
            min-height: 100vh;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
            background-size: cover;
            background-position: center;
        }

        .admin-container {
            display: flex;
            max-width: 1800px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            flex-direction: column;
        }

        .admin-header {
            padding: 1.5rem 2rem;
            background: var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .admin-header h1 { 
            font-size: 2rem; 
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 120px);
        }

        .admin-sidebar {
            background: var(--secondary);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .admin-nav { 
            list-style: none; 
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .admin-nav li { 
            margin-bottom: 0.5rem; 
        }

        .admin-nav a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.2rem;
            color: var(--text-light);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .admin-nav a:hover {
            background: rgba(251, 191, 36, 0.1);
            color: var(--accent-gold);
            transform: translateX(5px);
        }

        .admin-nav a.active {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(16, 185, 129, 0.2));
            color: var(--accent-gold);
            border-left: 4px solid var(--accent-gold);
        }

        .admin-nav a i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .admin-main {
            background: var(--secondary);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .admin-tab {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .admin-tab.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Admin Stats */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-stat-card {
            background: var(--primary);
            padding: 1.8rem;
            border-radius: var(--radius);
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .admin-stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-gold);
            box-shadow: 0 10px 20px rgba(251, 191, 36, 0.1);
        }

        .admin-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-emerald));
        }

        .admin-stat-card .value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--accent-gold);
            display: block;
            margin-bottom: 0.5rem;
        }

        .admin-stat-card .label {
            color: var(--text-muted);
            font-size: 0.95rem;
            display: block;
        }

        .admin-stat-card .change {
            display: block;
            margin-top: 0.8rem;
            font-size: 0.85rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            display: inline-block;
        }

        .change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        /* Charts */
        .chart-container {
            background: var(--primary);
            padding: 1.8rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chart-container h3 {
            margin-bottom: 1.5rem;
            color: var(--text-light);
            font-size: 1.3rem;
        }

        /* Admin Tables */
        .admin-table-container {
            background: var(--primary);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 2rem;
        }

        .admin-table-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-table-header h3 {
            color: var(--text-light);
            font-size: 1.3rem;
        }

        .admin-table-filters {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.7rem 1.2rem;
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            color: var(--text-light);
            font-size: 0.9rem;
            min-width: 150px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-select:hover {
            border-color: var(--accent-gold);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-emerald);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        .search-input {
            padding: 0.7rem 1.2rem;
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            color: var(--text-light);
            font-size: 0.9rem;
            width: 300px;
            max-width: 100%;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-emerald);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        .search-button {
            padding: 0.7rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-gold), #d97706);
            border: none;
            border-radius: var(--radius);
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th {
            padding: 1.2rem 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-muted);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
        }

        .admin-table tbody tr {
            transition: var(--transition);
        }

        .admin-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Status Badges */
        .status-badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            display: inline-block;
        }

        .status-badge.pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-badge.approved {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-badge.rejected {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-badge.active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-badge.suspended {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-badge.inactive {
            background: rgba(100, 116, 139, 0.2);
            color: var(--text-muted);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 0.5rem 0.8rem;
            border-radius: var(--radius);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            outline: none;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .btn-sm i {
            font-size: 0.9rem;
        }

        .btn-sm-primary {
            background: linear-gradient(135deg, var(--accent-gold), #d97706);
            color: var(--primary);
        }

        .btn-sm-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-sm-outline {
            background: transparent;
            border: 1px solid var(--accent-emerald);
            color: var(--accent-emerald);
        }

        .btn-sm-outline:hover {
            background: var(--accent-emerald);
            color: var(--primary);
        }

        .btn-sm-danger {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--error);
        }

        .btn-sm-danger:hover {
            background: var(--error);
            color: white;
        }

        .btn-sm-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: var(--info);
        }

        .btn-sm-info:hover {
            background: var(--info);
            color: white;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .pagination-button {
            padding: 0.6rem 1rem;
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .pagination-button:hover:not(:disabled) {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .pagination-button.active {
            background: var(--accent-gold);
            color: var(--primary);
            border-color: var(--accent-gold);
        }

        .pagination-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--primary);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalAppear 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--primary);
            z-index: 1;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--accent-gold);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-gold);
        }

        .modal-body {
            padding: 2rem;
        }

        /* User Details Modal */
        .user-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .user-detail-card {
            background: var(--secondary);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-detail-card h4 {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-detail-value {
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .user-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .user-tab {
            padding: 0.8rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius) var(--radius) 0 0;
            position: relative;
        }

        .user-tab:hover {
            color: var(--text-light);
        }

        .user-tab.active {
            color: var(--accent-gold);
            background: rgba(251, 191, 36, 0.1);
        }

        .user-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-gold);
            border-radius: 3px 3px 0 0;
        }

        .user-tab-content {
            display: none;
        }

        .user-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Proof Image Modal */
        .proof-image-container {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .proof-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }

        .proof-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .proof-detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .proof-detail-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .proof-detail-value {
            color: var(--text-light);
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .admin-content {
                grid-template-columns: 1fr;
            }
            
            .admin-sidebar {
                position: static;
                margin-bottom: 1rem;
            }
            
            .admin-nav {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .admin-nav a {
                padding: 0.8rem 1rem;
            }
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-table-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                width: 100%;
            }
            
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            
            .user-details-grid {
                grid-template-columns: 1fr;
            }
            
            .user-tabs {
                flex-direction: column;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .admin-container {
                padding: 10px;
            }
            
            .admin-header,
            .admin-sidebar,
            .admin-main {
                padding: 1.2rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-sm {
                width: 100%;
                justify-content: center;
            }
        }

        /* Additional Styling */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--text-muted);
            opacity: 0.5;
        }

        .loading-row {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .loading-row i {
            font-size: 1.5rem;
            animation: spin 1s linear infinite;
        }

        .date-range-picker {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-input {
            padding: 0.7rem 1rem;
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--accent-emerald);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal-actions .btn {
            flex: 1;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold), #d97706);
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
        }

        .btn-secondary:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .image-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .zoom-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            border-radius: var(--radius);
        }

        .zoom-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .zoom-button:hover {
            background: var(--accent-gold);
            color: var(--primary);
        }

        .zoom-level {
            min-width: 60px;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Stats Highlights */
        .stats-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stats-highlight {
            background: var(--primary);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stats-highlight-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-gold), #d97706);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .stats-highlight-content {
            flex: 1;
        }

        .stats-highlight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            display: block;
        }

        .stats-highlight-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: block;
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quick-action {
            background: var(--primary);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.05);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-action:hover {
            transform: translateY(-5px);
            border-color: var(--accent-gold);
            box-shadow: 0 10px 20px rgba(251, 191, 36, 0.1);
        }

        .quick-action i {
            font-size: 2rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }

        .quick-action span {
            color: var(--text-light);
            font-weight: 500;
            display: block;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--error);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .admin-nav li {
            position: relative;
        }

        /* Refresh Button */
        .refresh-button {
            background: transparent;
            border: 1px solid var(--accent-emerald);
            color: var(--accent-emerald);
            padding: 0.7rem 1.2rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .refresh-button:hover {
            background: var(--accent-emerald);
            color: var(--primary);
        }

        .refresh-button.loading i {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
        <p>Loading admin dashboard...</p>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Admin Page -->
    <div id="admin-page" class="admin-page">
        <div class="admin-container">
            <div class="admin-header">
                <h1><i class="fas fa-shield-alt"></i> Raw Wealthy Admin Dashboard</h1>
                <div class="admin-actions">
                    <button class="refresh-button" onclick="admin.loadDashboardData()" id="refresh-button">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn-sm-danger" onclick="admin.logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <div class="admin-content">
                <!-- Sidebar -->
                <div class="admin-sidebar">
                    <ul class="admin-nav">
                        <li>
                            <a href="#" class="active" onclick="admin.switchTab('overview')">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Overview</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('users')">
                                <i class="fas fa-users"></i>
                                <span>Users</span>
                                <span class="notification-badge" id="users-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('investments')">
                                <i class="fas fa-chart-line"></i>
                                <span>Investments</span>
                                <span class="notification-badge" id="investments-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('deposits')">
                                <i class="fas fa-wallet"></i>
                                <span>Deposits</span>
                                <span class="notification-badge" id="deposits-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('withdrawals')">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Withdrawals</span>
                                <span class="notification-badge" id="withdrawals-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('kyc')">
                                <i class="fas fa-id-card"></i>
                                <span>KYC Verification</span>
                                <span class="notification-badge" id="kyc-badge">0</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('transactions')">
                                <i class="fas fa-exchange-alt"></i>
                                <span>Transactions</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('reports')">
                                <i class="fas fa-file-chart-line"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="admin.switchTab('settings')">
                                <i class="fas fa-cogs"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Main Content -->
                <div class="admin-main">
                    <!-- Overview Tab -->
                    <div id="overview-tab" class="admin-tab active">
                        <div class="stats-highlights">
                            <div class="stats-highlight">
                                <div class="stats-highlight-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stats-highlight-content">
                                    <span class="stats-highlight-value" id="total-users">0</span>
                                    <span class="stats-highlight-label">Total Users</span>
                                </div>
                            </div>
                            <div class="stats-highlight">
                                <div class="stats-highlight-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stats-highlight-content">
                                    <span class="stats-highlight-value" id="total-investments">₦0</span>
                                    <span class="stats-highlight-label">Total Investments</span>
                                </div>
                            </div>
                            <div class="stats-highlight">
                                <div class="stats-highlight-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="stats-highlight-content">
                                    <span class="stats-highlight-value" id="total-deposits">₦0</span>
                                    <span class="stats-highlight-label">Total Deposits</span>
                                </div>
                            </div>
                            <div class="stats-highlight">
                                <div class="stats-highlight-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="stats-highlight-content">
                                    <span class="stats-highlight-value" id="total-withdrawals">₦0</span>
                                    <span class="stats-highlight-label">Total Withdrawals</span>
                                </div>
                            </div>
                        </div>

                        <div class="admin-stats-grid">
                            <div class="admin-stat-card">
                                <span class="value" id="active-users">0</span>
                                <span class="label">Active Users</span>
                                <span class="change positive" id="active-users-change">+0%</span>
                            </div>
                            <div class="admin-stat-card">
                                <span class="value" id="pending-investments">0</span>
                                <span class="label">Pending Investments</span>
                            </div>
                            <div class="admin-stat-card">
                                <span class="value" id="pending-deposits">0</span>
                                <span class="label">Pending Deposits</span>
                            </div>
                            <div class="admin-stat-card">
                                <span class="value" id="pending-withdrawals">0</span>
                                <span class="label">Pending Withdrawals</span>
                            </div>
                            <div class="admin-stat-card">
                                <span class="value" id="pending-kyc">0</span>
                                <span class="label">Pending KYC</span>
                            </div>
                            <div class="admin-stat-card">
                                <span class="value" id="today-earnings">₦0</span>
                                <span class="label">Today's Earnings</span>
                                <span class="change positive" id="today-earnings-change">+0%</span>
                            </div>
                        </div>

                        <div class="quick-actions-grid">
                            <div class="quick-action" onclick="admin.switchTab('users')">
                                <i class="fas fa-user-plus"></i>
                                <span>Add New User</span>
                            </div>
                            <div class="quick-action" onclick="admin.switchTab('reports')">
                                <i class="fas fa-file-export"></i>
                                <span>Generate Report</span>
                            </div>
                            <div class="quick-action" onclick="admin.openBroadcastModal()">
                                <i class="fas fa-bullhorn"></i>
                                <span>Send Broadcast</span>
                            </div>
                            <div class="quick-action" onclick="admin.switchTab('settings')">
                                <i class="fas fa-sliders-h"></i>
                                <span>Platform Settings</span>
                            </div>
                        </div>

                        <div class="chart-container">
                            <h3>Platform Growth (Last 30 Days)</h3>
                            <canvas id="growth-chart"></canvas>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div id="users-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>User Management</h3>
                            <div class="admin-table-filters">
                                <input type="text" class="search-input" placeholder="Search users..." id="user-search">
                                <select class="filter-select" id="user-status-filter">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="suspended">Suspended</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <select class="filter-select" id="user-kyc-filter">
                                    <option value="">All KYC Status</option>
                                    <option value="verified">Verified</option>
                                    <option value="pending">Pending</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                                <button class="search-button" onclick="admin.loadUsers()">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </div>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>KYC</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                            <div class="pagination" id="users-pagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Investments Tab -->
                    <div id="investments-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>Investment Management</h3>
                            <div class="admin-table-filters">
                                <select class="filter-select" id="investment-status-filter">
                                    <option value="pending">Pending</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                    <option value="all">All</option>
                                </select>
                                <div class="date-range-picker">
                                    <input type="date" class="date-input" id="investment-start-date">
                                    <span>to</span>
                                    <input type="date" class="date-input" id="investment-end-date">
                                </div>
                                <button class="search-button" onclick="admin.loadInvestments()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Plan</th>
                                        <th>Amount</th>
                                        <th>Daily Interest</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Status</th>
                                        <th>Proof</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="investments-table-body">
                                    <!-- Investments will be loaded here -->
                                </tbody>
                            </table>
                            <div class="pagination" id="investments-pagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Deposits Tab -->
                    <div id="deposits-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>Deposit Management</h3>
                            <div class="admin-table-filters">
                                <select class="filter-select" id="deposit-status-filter">
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="all">All</option>
                                </select>
                                <select class="filter-select" id="deposit-method-filter">
                                    <option value="">All Methods</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="crypto">Cryptocurrency</option>
                                    <option value="paypal">PayPal</option>
                                    <option value="card">Card</option>
                                </select>
                                <button class="search-button" onclick="admin.loadDeposits()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Proof</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="deposits-table-body">
                                    <!-- Deposits will be loaded here -->
                                </tbody>
                            </table>
                            <div class="pagination" id="deposits-pagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Withdrawals Tab -->
                    <div id="withdrawals-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>Withdrawal Management</h3>
                            <div class="admin-table-filters">
                                <select class="filter-select" id="withdrawal-status-filter">
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="all">All</option>
                                </select>
                                <select class="filter-select" id="withdrawal-method-filter">
                                    <option value="">All Methods</option>
                                    <option value="bank_transfer">Bank Transfer</option>
                                    <option value="crypto">Cryptocurrency</option>
                                    <option value="paypal">PayPal</option>
                                </select>
                                <button class="search-button" onclick="admin.loadWithdrawals()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Fee</th>
                                        <th>Net Amount</th>
                                        <th>Method</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="withdrawals-table-body">
                                    <!-- Withdrawals will be loaded here -->
                                </tbody>
                            </table>
                            <div class="pagination" id="withdrawals-pagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- KYC Tab -->
                    <div id="kyc-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>KYC Verification</h3>
                            <div class="admin-table-filters">
                                <select class="filter-select" id="kyc-status-filter">
                                    <option value="pending">Pending</option>
                                    <option value="verified">Verified</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="all">All</option>
                                </select>
                                <select class="filter-select" id="kyc-type-filter">
                                    <option value="">All ID Types</option>
                                    <option value="national_id">National ID</option>
                                    <option value="passport">Passport</option>
                                    <option value="driver_license">Driver's License</option>
                                </select>
                                <button class="search-button" onclick="admin.loadKYC()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>ID Type</th>
                                        <th>ID Number</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Documents</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="kyc-table-body">
                                    <!-- KYC requests will be loaded here -->
                                </tbody>
                            </table>
                            <div class="pagination" id="kyc-pagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Transactions Tab -->
                    <div id="transactions-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>Transaction History</h3>
                            <div class="admin-table-filters">
                                <select class="filter-select" id="transaction-type-filter">
                                    <option value="">All Types</option>
                                    <option value="deposit">Deposit</option>
                                    <option value="withdrawal">Withdrawal</option>
                                    <option value="investment">Investment</option>
                                    <option value="earning">Earning</option>
                                    <option value="referral">Referral</option>
                                </select>
                                <div class="date-range-picker">
                                    <input type="date" class="date-input" id="transaction-start-date">
                                    <span>to</span>
                                    <input type="date" class="date-input" id="transaction-end-date">
                                </div>
                                <button class="search-button" onclick="admin.loadTransactions()">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Description</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="transactions-table-body">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                            <div class="pagination" id="transactions-pagination">
                                <!-- Pagination will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="reports-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>Reports & Analytics</h3>
                            <div class="admin-table-filters">
                                <select class="filter-select" id="report-type">
                                    <option value="daily">Daily Report</option>
                                    <option value="weekly">Weekly Report</option>
                                    <option value="monthly">Monthly Report</option>
                                    <option value="custom">Custom Report</option>
                                </select>
                                <div class="date-range-picker" id="custom-date-range" style="display: none;">
                                    <input type="date" class="date-input" id="report-start-date">
                                    <span>to</span>
                                    <input type="date" class="date-input" id="report-end-date">
                                </div>
                                <button class="search-button" onclick="admin.generateReport()">
                                    <i class="fas fa-download"></i> Generate Report
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h3>Revenue Overview</h3>
                            <canvas id="revenue-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>User Growth</h3>
                            <canvas id="user-growth-chart"></canvas>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="settings-tab" class="admin-tab">
                        <div class="admin-table-header">
                            <h3>Platform Settings</h3>
                        </div>
                        <div class="user-details-grid">
                            <div class="user-detail-card">
                                <h4>Platform Fee</h4>
                                <div class="user-detail-value" id="platform-fee">5%</div>
                                <button class="btn-sm-outline" onclick="admin.editPlatformFee()">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="user-detail-card">
                                <h4>Referral Commission</h4>
                                <div class="user-detail-value" id="referral-commission">15%</div>
                                <button class="btn-sm-outline" onclick="admin.editReferralCommission()">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="user-detail-card">
                                <h4>Minimum Investment</h4>
                                <div class="user-detail-value" id="min-investment">₦3,500</div>
                                <button class="btn-sm-outline" onclick="admin.editMinInvestment()">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="user-detail-card">
                                <h4>Minimum Deposit</h4>
                                <div class="user-detail-value" id="min-deposit">₦500</div>
                                <button class="btn-sm-outline" onclick="admin.editMinDeposit()">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="user-detail-card">
                                <h4>Minimum Withdrawal</h4>
                                <div class="user-detail-value" id="min-withdrawal">₦1,000</div>
                                <button class="btn-sm-outline" onclick="admin.editMinWithdrawal()">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                            <div class="user-detail-card">
                                <h4>Platform Status</h4>
                                <div class="user-detail-value">
                                    <span class="status-badge active" id="platform-status">Active</span>
                                </div>
                                <button class="btn-sm-outline" onclick="admin.togglePlatformStatus()">
                                    <i class="fas fa-power-off"></i> Toggle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div id="user-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user"></i> User Details</h2>
                <button class="close-modal" onclick="admin.closeModal('user-details-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="user-details-content">
                    <!-- User details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Proof Image Modal -->
    <div id="proof-image-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-image"></i> Payment Proof</h2>
                <button class="close-modal" onclick="admin.closeModal('proof-image-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="proof-image-container">
                    <img id="proof-image" src="" alt="Proof Image" class="proof-image">
                    <div class="image-actions">
                        <div class="zoom-controls">
                            <button class="zoom-button" onclick="admin.zoomOut()">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <span class="zoom-level" id="zoom-level">100%</span>
                            <button class="zoom-button" onclick="admin.zoomIn()">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                        <button class="btn-sm-info" onclick="admin.downloadProof()">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
                <div class="proof-details" id="proof-details">
                    <!-- Proof details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- KYC Documents Modal -->
    <div id="kyc-documents-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-id-card"></i> KYC Documents</h2>
                <button class="close-modal" onclick="admin.closeModal('kyc-documents-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="kyc-documents-content">
                    <!-- KYC documents will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Broadcast Modal -->
    <div id="broadcast-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-bullhorn"></i> Send Broadcast Message</h2>
                <button class="close-modal" onclick="admin.closeModal('broadcast-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="broadcast-form">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Recipients</label>
                        <select class="filter-select" style="width: 100%;" id="broadcast-recipients">
                            <option value="all">All Users</option>
                            <option value="active">Active Users Only</option>
                            <option value="investors">Investors Only</option>
                            <option value="non-investors">Non-Investors Only</option>
                            <option value="verified">KYC Verified Only</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Subject</label>
                        <input type="text" class="search-input" style="width: 100%;" id="broadcast-subject" placeholder="Enter subject" required>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Message</label>
                        <textarea class="search-input" style="width: 100%; height: 200px; resize: vertical;" id="broadcast-message" placeholder="Enter your message" required></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="admin.closeModal('broadcast-modal')">
                            Cancel
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-paper-plane"></i> Send Broadcast
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Setting Modal -->
    <div id="edit-setting-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> Edit Platform Setting</h2>
                <button class="close-modal" onclick="admin.closeModal('edit-setting-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-setting-form">
                    <div id="setting-form-content">
                        <!-- Form content will be loaded here -->
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="admin.closeModal('edit-setting-modal')">
                            Cancel
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ==================== RAW WEALTHY ADMIN DASHBOARD ====================
        const admin = {
            // ==================== CONFIGURATION ====================
            config: {
                API_BASE_URL: (() => {
                    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                        return 'http://localhost:10000';
                    }
                    return window.location.origin.includes('vercel.app')
                        ? 'https://real-wealthy-1.onrender.com'
                        : window.location.origin;
                })(),
                TOKEN_KEY: 'raw_wealthy_admin_token',
                VERSION: '2.0.0',
                ITEMS_PER_PAGE: 10,
                CHART_COLORS: {
                    primary: '#f59e0b',
                    success: '#10b981',
                    info: '#3b82f6',
                    warning: '#f59e0b',
                    error: '#ef4444'
                }
            },

            // ==================== APPLICATION STATE ====================
            state: {
                token: localStorage.getItem(this?.config?.TOKEN_KEY || 'raw_wealthy_admin_token'),
                currentAdmin: null,
                currentTab: 'overview',
                currentPage: {
                    users: 1,
                    investments: 1,
                    deposits: 1,
                    withdrawals: 1,
                    kyc: 1,
                    transactions: 1
                },
                totalPages: {},
                filters: {
                    users: {},
                    investments: {},
                    deposits: {},
                    withdrawals: {},
                    kyc: {},
                    transactions: {}
                },
                charts: {},
                zoomLevel: 100
            },

            // ==================== INITIALIZATION ====================
            async init() {
                console.log('🚀 Raw Wealthy Admin Dashboard v2.0 Initializing...');
                console.log(`🌐 Backend URL: ${this.config.API_BASE_URL}`);
                
                this.setupEventListeners();
                await this.checkAuthentication();
                this.setupTabSwitching();
                await this.loadDashboardData();
                
                // Auto-refresh data every 30 seconds
                setInterval(() => {
                    if (document.visibilityState === 'visible') {
                        this.loadDashboardData();
                    }
                }, 30000);
            },

            // ==================== AUTHENTICATION ====================
            async checkAuthentication() {
                if (!this.state.token) {
                    this.showToast('Please login to access admin dashboard', 'error');
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 2000);
                    return;
                }

                try {
                    await this.verifyToken();
                } catch (error) {
                    this.handleTokenExpired();
                }
            },

            async verifyToken() {
                try {
                    const response = await this.apiRequest('/api/admin/verify');
                    this.state.currentAdmin = response.data.admin;
                    
                    if (!this.state.currentAdmin || (this.state.currentAdmin.role !== 'admin' && this.state.currentAdmin.role !== 'super_admin')) {
                        throw new Error('Unauthorized access');
                    }
                    
                    console.log('✅ Admin authenticated:', this.state.currentAdmin.email);
                } catch (error) {
                    throw error;
                }
            },

            handleTokenExpired() {
                localStorage.removeItem(this.config.TOKEN_KEY);
                this.state.token = null;
                this.showToast('Session expired. Please login again.', 'warning');
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 2000);
            },

            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem(this.config.TOKEN_KEY);
                    window.location.href = '/login.html';
                }
            },

            // ==================== API REQUEST HANDLER ====================
            async apiRequest(endpoint, options = {}) {
                const url = this.config.API_BASE_URL + endpoint;
                
                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${this.state.token}`,
                    ...options.headers
                };

                const config = {
                    method: options.method || 'GET',
                    headers: headers,
                    ...options
                };

                if (options.body) {
                    if (options.body instanceof FormData) {
                        delete config.headers['Content-Type'];
                        config.body = options.body;
                    } else {
                        config.body = JSON.stringify(options.body);
                    }
                }

                try {
                    this.showLoadingSpinner(true);
                    const response = await fetch(url, config);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || `HTTP ${response.status}`);
                    }

                    return data;
                } catch (error) {
                    console.error('API Request Error:', error);
                    
                    if (error.message.includes('401') || error.message.includes('token')) {
                        this.handleTokenExpired();
                    }
                    
                    this.showToast(error.message || 'Network error. Please try again.', 'error');
                    throw error;
                } finally {
                    this.showLoadingSpinner(false);
                }
            },

            // ==================== DASHBOARD DATA ====================
            async loadDashboardData() {
                try {
                    const refreshBtn = document.getElementById('refresh-button');
                    if (refreshBtn) {
                        refreshBtn.classList.add('loading');
                        refreshBtn.disabled = true;
                    }

                    // Load overview stats
                    await this.loadOverviewStats();
                    
                    // Load data for current tab
                    switch(this.state.currentTab) {
                        case 'users':
                            await this.loadUsers();
                            break;
                        case 'investments':
                            await this.loadInvestments();
                            break;
                        case 'deposits':
                            await this.loadDeposits();
                            break;
                        case 'withdrawals':
                            await this.loadWithdrawals();
                            break;
                        case 'kyc':
                            await this.loadKYC();
                            break;
                        case 'transactions':
                            await this.loadTransactions();
                            break;
                        case 'reports':
                            await this.loadReports();
                            break;
                        case 'settings':
                            await this.loadSettings();
                            break;
                    }

                    // Update notification badges
                    await this.updateNotificationBadges();
                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                } finally {
                    const refreshBtn = document.getElementById('refresh-button');
                    if (refreshBtn) {
                        refreshBtn.classList.remove('loading');
                        refreshBtn.disabled = false;
                    }
                }
            },

            async loadOverviewStats() {
                try {
                    const response = await this.apiRequest('/api/admin/dashboard/stats');
                    const stats = response.data.stats || {};

                    // Update stat cards
                    this.updateStatCard('total-users', stats.total_users || 0);
                    this.updateStatCard('total-investments', `₦${this.formatNumber(stats.total_investments || 0)}`);
                    this.updateStatCard('total-deposits', `₦${this.formatNumber(stats.total_deposits || 0)}`);
                    this.updateStatCard('total-withdrawals', `₦${this.formatNumber(stats.total_withdrawals || 0)}`);
                    this.updateStatCard('active-users', stats.active_users || 0);
                    this.updateStatCard('pending-investments', stats.pending_investments || 0);
                    this.updateStatCard('pending-deposits', stats.pending_deposits || 0);
                    this.updateStatCard('pending-withdrawals', stats.pending_withdrawals || 0);
                    this.updateStatCard('pending-kyc', stats.pending_kyc || 0);
                    this.updateStatCard('today-earnings', `₦${this.formatNumber(stats.today_earnings || 0)}`);

                    // Create growth chart
                    this.createGrowthChart(stats.growth_data || []);
                } catch (error) {
                    console.error('Failed to load overview stats:', error);
                }
            },

            async updateNotificationBadges() {
                try {
                    const response = await this.apiRequest('/api/admin/dashboard/notifications');
                    const counts = response.data.counts || {};

                    this.updateBadge('users-badge', counts.pending_users || 0);
                    this.updateBadge('investments-badge', counts.pending_investments || 0);
                    this.updateBadge('deposits-badge', counts.pending_deposits || 0);
                    this.updateBadge('withdrawals-badge', counts.pending_withdrawals || 0);
                    this.updateBadge('kyc-badge', counts.pending_kyc || 0);
                } catch (error) {
                    console.error('Failed to update notification badges:', error);
                }
            },

            // ==================== USER MANAGEMENT ====================
            async loadUsers(page = 1) {
                try {
                    this.state.currentPage.users = page;
                    
                    const search = document.getElementById('user-search')?.value || '';
                    const status = document.getElementById('user-status-filter')?.value || '';
                    const kycStatus = document.getElementById('user-kyc-filter')?.value || '';

                    const params = new URLSearchParams({
                        page: page,
                        limit: this.config.ITEMS_PER_PAGE,
                        ...(search && { search }),
                        ...(status && { status }),
                        ...(kycStatus && { kyc_status: kycStatus })
                    });

                    const response = await this.apiRequest(`/api/admin/users?${params}`);
                    const data = response.data;

                    this.renderUsersTable(data.users || []);
                    this.renderPagination('users-pagination', data.pagination || {}, 'users');
                } catch (error) {
                    console.error('Failed to load users:', error);
                    this.showEmptyState('users-table-body', 'Failed to load users');
                }
            },

            renderUsersTable(users) {
                const tbody = document.getElementById('users-table-body');
                if (!tbody) return;

                if (users.length === 0) {
                    this.showEmptyState('users-table-body', 'No users found');
                    return;
                }

                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user._id?.substring(0, 8) || 'N/A'}</td>
                        <td>
                            <strong>${user.full_name || 'N/A'}</strong>
                            <br>
                            <small style="color: var(--text-muted);">${user.email || 'N/A'}</small>
                        </td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td><strong>₦${this.formatNumber(user.balance || 0)}</strong></td>
                        <td>
                            <span class="status-badge ${user.status || 'inactive'}">
                                ${user.status || 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge ${user.kyc_verified ? 'approved' : 'pending'}">
                                ${user.kyc_verified ? 'Verified' : 'Pending'}
                            </span>
                        </td>
                        <td>${this.formatDate(user.createdAt)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-sm-primary" onclick="admin.viewUserDetails('${user._id}')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn-sm-outline" onclick="admin.editUser('${user._id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-sm-${user.status === 'active' ? 'danger' : 'outline'}" 
                                        onclick="admin.toggleUserStatus('${user._id}', '${user.status === 'active' ? 'suspended' : 'active'}')">
                                    <i class="fas fa-${user.status === 'active' ? 'ban' : 'check'}"></i>
                                    ${user.status === 'active' ? 'Suspend' : 'Activate'}
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            async viewUserDetails(userId) {
                try {
                    const response = await this.apiRequest(`/api/admin/users/${userId}`);
                    const user = response.data.user;
                    const stats = response.data.stats || {};

                    const content = `
                        <div class="user-details-grid">
                            <div class="user-detail-card">
                                <h4>Full Name</h4>
                                <div class="user-detail-value">${user.full_name || 'N/A'}</div>
                            </div>
                            <div class="user-detail-card">
                                <h4>Email</h4>
                                <div class="user-detail-value">${user.email || 'N/A'}</div>
                            </div>
                            <div class="user-detail-card">
                                <h4>Phone</h4>
                                <div class="user-detail-value">${user.phone || 'N/A'}</div>
                            </div>
                            <div class="user-detail-card">
                                <h4>Account Balance</h4>
                                <div class="user-detail-value">₦${this.formatNumber(user.balance || 0)}</div>
                            </div>
                            <div class="user-detail-card">
                                <h4>Total Earned</h4>
                                <div class="user-detail-value">₦${this.formatNumber(user.total_earnings || 0)}</div>
                            </div>
                            <div class="user-detail-card">
                                <h4>Referral Earnings</h4>
                                <div class="user-detail-value">₦${this.formatNumber(user.referral_earnings || 0)}</div>
                            </div>
                            <div class="user-detail-card">
                                <h4>Account Status</h4>
                                <div class="user-detail-value">
                                    <span class="status-badge ${user.status || 'inactive'}">
                                        ${user.status || 'Inactive'}
                                    </span>
                                </div>
                            </div>
                            <div class="user-detail-card">
                                <h4>KYC Status</h4>
                                <div class="user-detail-value">
                                    <span class="status-badge ${user.kyc_verified ? 'approved' : 'pending'}">
                                        ${user.kyc_verified ? 'Verified' : 'Pending'}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="user-tabs">
                            <button class="user-tab active" onclick="admin.switchUserTab('personal')">Personal Info</button>
                            <button class="user-tab" onclick="admin.switchUserTab('bank')">Bank Details</button>
                            <button class="user-tab" onclick="admin.switchUserTab('investments')">Investments</button>
                            <button class="user-tab" onclick="admin.switchUserTab('transactions')">Transactions</button>
                            <button class="user-tab" onclick="admin.switchUserTab('referrals')">Referrals</button>
                        </div>

                        <div id="user-personal-tab" class="user-tab-content active">
                            <div class="user-details-grid">
                                <div class="user-detail-card">
                                    <h4>User ID</h4>
                                    <div class="user-detail-value">${user._id || 'N/A'}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Referral Code</h4>
                                    <div class="user-detail-value">${user.referral_code || 'N/A'}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Joined Date</h4>
                                    <div class="user-detail-value">${this.formatDate(user.createdAt)}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Last Login</h4>
                                    <div class="user-detail-value">${user.last_login ? this.formatDate(user.last_login) : 'Never'}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>IP Address</h4>
                                    <div class="user-detail-value">${user.last_ip || 'N/A'}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Device</h4>
                                    <div class="user-detail-value">${user.last_device || 'N/A'}</div>
                                </div>
                            </div>
                        </div>

                        <div id="user-bank-tab" class="user-tab-content">
                            <div class="user-details-grid">
                                <div class="user-detail-card">
                                    <h4>Bank Name</h4>
                                    <div class="user-detail-value">${user.bank_name || 'Not Provided'}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Account Name</h4>
                                    <div class="user-detail-value">${user.account_name || 'Not Provided'}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Account Number</h4>
                                    <div class="user-detail-value">${user.account_number || 'Not Provided'}</div>
                                </div>
                            </div>
                        </div>

                        <div id="user-investments-tab" class="user-tab-content">
                            <div style="margin-bottom: 1.5rem;">
                                <h4>Investment Stats</h4>
                                <div class="user-details-grid">
                                    <div class="user-detail-card">
                                        <h4>Total Investments</h4>
                                        <div class="user-detail-value">${stats.total_investments || 0}</div>
                                    </div>
                                    <div class="user-detail-card">
                                        <h4>Active Investments</h4>
                                        <div class="user-detail-value">${stats.active_investments || 0}</div>
                                    </div>
                                    <div class="user-detail-card">
                                        <h4>Total Invested</h4>
                                        <div class="user-detail-value">₦${this.formatNumber(stats.total_invested || 0)}</div>
                                    </div>
                                    <div class="user-detail-card">
                                        <h4>Total Earned</h4>
                                        <div class="user-detail-value">₦${this.formatNumber(stats.total_earned || 0)}</div>
                                    </div>
                                </div>
                            </div>
                            <div id="user-investments-list">
                                <!-- Investments will be loaded dynamically -->
                            </div>
                        </div>

                        <div id="user-transactions-tab" class="user-tab-content">
                            <div id="user-transactions-list">
                                <!-- Transactions will be loaded dynamically -->
                            </div>
                        </div>

                        <div id="user-referrals-tab" class="user-tab-content">
                            <div class="user-details-grid">
                                <div class="user-detail-card">
                                    <h4>Total Referrals</h4>
                                    <div class="user-detail-value">${stats.total_referrals || 0}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Active Referrals</h4>
                                    <div class="user-detail-value">${stats.active_referrals || 0}</div>
                                </div>
                                <div class="user-detail-card">
                                    <h4>Referral Earnings</h4>
                                    <div class="user-detail-value">₦${this.formatNumber(user.referral_earnings || 0)}</div>
                                </div>
                            </div>
                            <div id="user-referrals-list">
                                <!-- Referrals will be loaded dynamically -->
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button class="btn-secondary" onclick="admin.closeModal('user-details-modal')">
                                Close
                            </button>
                            <button class="btn-primary" onclick="admin.editUser('${user._id}')">
                                <i class="fas fa-edit"></i> Edit User
                            </button>
                        </div>
                    `;

                    document.getElementById('user-details-content').innerHTML = content;
                    this.openModal('user-details-modal');

                    // Load user's investments
                    this.loadUserInvestments(userId);
                    // Load user's transactions
                    this.loadUserTransactions(userId);
                    // Load user's referrals
                    this.loadUserReferrals(userId);
                } catch (error) {
                    console.error('Failed to load user details:', error);
                    this.showToast('Failed to load user details', 'error');
                }
            },

            async loadUserInvestments(userId) {
                try {
                    const response = await this.apiRequest(`/api/admin/users/${userId}/investments`);
                    const investments = response.data.investments || [];

                    const container = document.getElementById('user-investments-list');
                    if (!container) return;

                    if (investments.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No investments found</p>';
                        return;
                    }

                    container.innerHTML = `
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Plan</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Amount</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Status</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Start Date</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">End Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${investments.map(inv => `
                                        <tr>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${inv.plan?.name || 'N/A'}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">₦${this.formatNumber(inv.amount || 0)}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <span class="status-badge ${inv.status || 'pending'}">${inv.status || 'Pending'}</span>
                                            </td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${this.formatDate(inv.start_date)}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${this.formatDate(inv.end_date)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } catch (error) {
                    console.error('Failed to load user investments:', error);
                }
            },

            async loadUserTransactions(userId) {
                try {
                    const response = await this.apiRequest(`/api/admin/users/${userId}/transactions`);
                    const transactions = response.data.transactions || [];

                    const container = document.getElementById('user-transactions-list');
                    if (!container) return;

                    if (transactions.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No transactions found</p>';
                        return;
                    }

                    container.innerHTML = `
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Type</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Amount</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Description</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Date</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${transactions.slice(0, 10).map(txn => `
                                        <tr>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <span class="status-badge ${txn.type}">${txn.type || 'N/A'}</span>
                                            </td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">₦${this.formatNumber(txn.amount || 0)}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${txn.description || 'N/A'}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${this.formatDate(txn.createdAt)}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <span class="status-badge ${txn.status || 'completed'}">${txn.status || 'Completed'}</span>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } catch (error) {
                    console.error('Failed to load user transactions:', error);
                }
            },

            async loadUserReferrals(userId) {
                try {
                    const response = await this.apiRequest(`/api/admin/users/${userId}/referrals`);
                    const referrals = response.data.referrals || [];

                    const container = document.getElementById('user-referrals-list');
                    if (!container) return;

                    if (referrals.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No referrals found</p>';
                        return;
                    }

                    container.innerHTML = `
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Referred User</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Email</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Joined Date</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Status</th>
                                        <th style="padding: 0.8rem; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1);">Commission</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${referrals.map(ref => `
                                        <tr>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${ref.user?.full_name || 'N/A'}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${ref.user?.email || 'N/A'}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">${this.formatDate(ref.user?.createdAt)}</td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                                <span class="status-badge ${ref.user?.status || 'inactive'}">${ref.user?.status || 'Inactive'}</span>
                                            </td>
                                            <td style="padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);">₦${this.formatNumber(ref.commission || 0)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } catch (error) {
                    console.error('Failed to load user referrals:', error);
                }
            },

            async editUser(userId) {
                this.showToast('Edit user functionality coming soon', 'info');
            },

            async toggleUserStatus(userId, newStatus) {
                if (!confirm(`Are you sure you want to ${newStatus === 'suspended' ? 'suspend' : 'activate'} this user?`)) {
                    return;
                }

                try {
                    await this.apiRequest(`/api/admin/users/${userId}/status`, {
                        method: 'PUT',
                        body: { status: newStatus }
                    });

                    this.showToast(`User ${newStatus === 'suspended' ? 'suspended' : 'activated'} successfully`, 'success');
                    this.loadUsers(this.state.currentPage.users);
                    
                    if (document.getElementById('user-details-modal').style.display === 'flex') {
                        this.closeModal('user-details-modal');
                    }
                } catch (error) {
                    console.error('Failed to toggle user status:', error);
                }
            },

            // ==================== INVESTMENT MANAGEMENT ====================
            async loadInvestments(page = 1) {
                try {
                    this.state.currentPage.investments = page;
                    
                    const status = document.getElementById('investment-status-filter')?.value || 'pending';
                    const startDate = document.getElementById('investment-start-date')?.value;
                    const endDate = document.getElementById('investment-end-date')?.value;

                    const params = new URLSearchParams({
                        page: page,
                        limit: this.config.ITEMS_PER_PAGE,
                        ...(status !== 'all' && { status }),
                        ...(startDate && { start_date: startDate }),
                        ...(endDate && { end_date: endDate })
                    });

                    const response = await this.apiRequest(`/api/admin/investments?${params}`);
                    const data = response.data;

                    this.renderInvestmentsTable(data.investments || []);
                    this.renderPagination('investments-pagination', data.pagination || {}, 'investments');
                } catch (error) {
                    console.error('Failed to load investments:', error);
                    this.showEmptyState('investments-table-body', 'Failed to load investments');
                }
            },

            renderInvestmentsTable(investments) {
                const tbody = document.getElementById('investments-table-body');
                if (!tbody) return;

                if (investments.length === 0) {
                    this.showEmptyState('investments-table-body', 'No investments found');
                    return;
                }

                tbody.innerHTML = investments.map(inv => `
                    <tr>
                        <td>${inv._id?.substring(0, 8) || 'N/A'}</td>
                        <td>
                            <strong>${inv.user?.full_name || 'N/A'}</strong>
                            <br>
                            <small style="color: var(--text-muted);">${inv.user?.email || 'N/A'}</small>
                        </td>
                        <td>${inv.plan?.name || 'N/A'}</td>
                        <td><strong>₦${this.formatNumber(inv.amount || 0)}</strong></td>
                        <td>${inv.plan?.daily_interest || 0}%</td>
                        <td>${this.formatDate(inv.start_date)}</td>
                        <td>${this.formatDate(inv.end_date)}</td>
                        <td>
                            <span class="status-badge ${inv.status || 'pending'}">
                                ${inv.status || 'Pending'}
                            </span>
                        </td>
                        <td>
                            ${inv.payment_proof ? `
                                <button class="btn-sm-info" onclick="admin.viewProofImage('${inv.payment_proof}', 'Investment', '₦${this.formatNumber(inv.amount)}', '${inv.user?.full_name}', '${this.formatDate(inv.createdAt)}')">
                                    <i class="fas fa-image"></i> View Proof
                                </button>
                            ` : 'No Proof'}
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${inv.status === 'pending' ? `
                                    <button class="btn-sm-primary" onclick="admin.approveInvestment('${inv._id}')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn-sm-danger" onclick="admin.rejectInvestment('${inv._id}')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                ` : ''}
                                <button class="btn-sm-outline" onclick="admin.viewInvestmentDetails('${inv._id}')">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            async approveInvestment(investmentId) {
                if (!confirm('Approve this investment?')) return;

                try {
                    await this.apiRequest(`/api/admin/investments/${investmentId}/approve`, {
                        method: 'POST'
                    });

                    this.showToast('Investment approved successfully', 'success');
                    this.loadInvestments(this.state.currentPage.investments);
                } catch (error) {
                    console.error('Failed to approve investment:', error);
                }
            },

            async rejectInvestment(investmentId) {
                const reason = prompt('Enter rejection reason:');
                if (!reason) return;

                try {
                    await this.apiRequest(`/api/admin/investments/${investmentId}/reject`, {
                        method: 'POST',
                        body: { remarks: reason }
                    });

                    this.showToast('Investment rejected', 'success');
                    this.loadInvestments(this.state.currentPage.investments);
                } catch (error) {
                    console.error('Failed to reject investment:', error);
                }
            },

            async viewInvestmentDetails(investmentId) {
                try {
                    const response = await this.apiRequest(`/api/admin/investments/${investmentId}`);
                    const investment = response.data.investment;

                    alert(`Investment Details:\n\n` +
                          `User: ${investment.user?.full_name}\n` +
                          `Plan: ${investment.plan?.name}\n` +
                          `Amount: ₦${this.formatNumber(investment.amount)}\n` +
                          `Daily Interest: ${investment.plan?.daily_interest}%\n` +
                          `Status: ${investment.status}\n` +
                          `Start Date: ${this.formatDate(investment.start_date)}\n` +
                          `End Date: ${this.formatDate(investment.end_date)}`);
                } catch (error) {
                    console.error('Failed to load investment details:', error);
                }
            },

            // ==================== DEPOSIT MANAGEMENT ====================
            async loadDeposits(page = 1) {
                try {
                    this.state.currentPage.deposits = page;
                    
                    const status = document.getElementById('deposit-status-filter')?.value || 'pending';
                    const method = document.getElementById('deposit-method-filter')?.value || '';

                    const params = new URLSearchParams({
                        page: page,
                        limit: this.config.ITEMS_PER_PAGE,
                        ...(status !== 'all' && { status }),
                        ...(method && { payment_method: method })
                    });

                    const response = await this.apiRequest(`/api/admin/deposits?${params}`);
                    const data = response.data;

                    this.renderDepositsTable(data.deposits || []);
                    this.renderPagination('deposits-pagination', data.pagination || {}, 'deposits');
                } catch (error) {
                    console.error('Failed to load deposits:', error);
                    this.showEmptyState('deposits-table-body', 'Failed to load deposits');
                }
            },

            renderDepositsTable(deposits) {
                const tbody = document.getElementById('deposits-table-body');
                if (!tbody) return;

                if (deposits.length === 0) {
                    this.showEmptyState('deposits-table-body', 'No deposits found');
                    return;
                }

                tbody.innerHTML = deposits.map(deposit => `
                    <tr>
                        <td>${deposit._id?.substring(0, 8) || 'N/A'}</td>
                        <td>
                            <strong>${deposit.user?.full_name || 'N/A'}</strong>
                            <br>
                            <small style="color: var(--text-muted);">${deposit.user?.email || 'N/A'}</small>
                        </td>
                        <td><strong>₦${this.formatNumber(deposit.amount || 0)}</strong></td>
                        <td>${deposit.payment_method || 'N/A'}</td>
                        <td>${this.formatDate(deposit.createdAt)}</td>
                        <td>
                            <span class="status-badge ${deposit.status || 'pending'}">
                                ${deposit.status || 'Pending'}
                            </span>
                        </td>
                        <td>
                            ${deposit.payment_proof ? `
                                <button class="btn-sm-info" onclick="admin.viewProofImage('${deposit.payment_proof}', 'Deposit', '₦${this.formatNumber(deposit.amount)}', '${deposit.user?.full_name}', '${this.formatDate(deposit.createdAt)}')">
                                    <i class="fas fa-image"></i> View Proof
                                </button>
                            ` : 'No Proof'}
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${deposit.status === 'pending' ? `
                                    <button class="btn-sm-primary" onclick="admin.approveDeposit('${deposit._id}')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn-sm-danger" onclick="admin.rejectDeposit('${deposit._id}')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            async approveDeposit(depositId) {
                if (!confirm('Approve this deposit?')) return;

                try {
                    await this.apiRequest(`/api/admin/deposits/${depositId}/approve`, {
                        method: 'POST'
                    });

                    this.showToast('Deposit approved successfully', 'success');
                    this.loadDeposits(this.state.currentPage.deposits);
                } catch (error) {
                    console.error('Failed to approve deposit:', error);
                }
            },

            async rejectDeposit(depositId) {
                const reason = prompt('Enter rejection reason:');
                if (!reason) return;

                try {
                    await this.apiRequest(`/api/admin/deposits/${depositId}/reject`, {
                        method: 'POST',
                        body: { remarks: reason }
                    });

                    this.showToast('Deposit rejected', 'success');
                    this.loadDeposits(this.state.currentPage.deposits);
                } catch (error) {
                    console.error('Failed to reject deposit:', error);
                }
            },

            // ==================== WITHDRAWAL MANAGEMENT ====================
            async loadWithdrawals(page = 1) {
                try {
                    this.state.currentPage.withdrawals = page;
                    
                    const status = document.getElementById('withdrawal-status-filter')?.value || 'pending';
                    const method = document.getElementById('withdrawal-method-filter')?.value || '';

                    const params = new URLSearchParams({
                        page: page,
                        limit: this.config.ITEMS_PER_PAGE,
                        ...(status !== 'all' && { status }),
                        ...(method && { payment_method: method })
                    });

                    const response = await this.apiRequest(`/api/admin/withdrawals?${params}`);
                    const data = response.data;

                    this.renderWithdrawalsTable(data.withdrawals || []);
                    this.renderPagination('withdrawals-pagination', data.pagination || {}, 'withdrawals');
                } catch (error) {
                    console.error('Failed to load withdrawals:', error);
                    this.showEmptyState('withdrawals-table-body', 'Failed to load withdrawals');
                }
            },

            renderWithdrawalsTable(withdrawals) {
                const tbody = document.getElementById('withdrawals-table-body');
                if (!tbody) return;

                if (withdrawals.length === 0) {
                    this.showEmptyState('withdrawals-table-body', 'No withdrawals found');
                    return;
                }

                tbody.innerHTML = withdrawals.map(withdrawal => `
                    <tr>
                        <td>${withdrawal._id?.substring(0, 8) || 'N/A'}</td>
                        <td>
                            <strong>${withdrawal.user?.full_name || 'N/A'}</strong>
                            <br>
                            <small style="color: var(--text-muted);">${withdrawal.user?.email || 'N/A'}</small>
                        </td>
                        <td><strong>₦${this.formatNumber(withdrawal.amount || 0)}</strong></td>
                        <td>₦${this.formatNumber(withdrawal.platform_fee || 0)}</td>
                        <td><strong>₦${this.formatNumber(withdrawal.net_amount || 0)}</strong></td>
                        <td>${withdrawal.payment_method || 'N/A'}</td>
                        <td>${this.formatDate(withdrawal.createdAt)}</td>
                        <td>
                            <span class="status-badge ${withdrawal.status || 'pending'}">
                                ${withdrawal.status || 'Pending'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${withdrawal.status === 'pending' ? `
                                    <button class="btn-sm-primary" onclick="admin.approveWithdrawal('${withdrawal._id}')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn-sm-danger" onclick="admin.rejectWithdrawal('${withdrawal._id}')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                ` : ''}
                                <button class="btn-sm-outline" onclick="admin.viewWithdrawalDetails('${withdrawal._id}')">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            async approveWithdrawal(withdrawalId) {
                if (!confirm('Approve this withdrawal?')) return;

                try {
                    await this.apiRequest(`/api/admin/withdrawals/${withdrawalId}/approve`, {
                        method: 'POST'
                    });

                    this.showToast('Withdrawal approved successfully', 'success');
                    this.loadWithdrawals(this.state.currentPage.withdrawals);
                } catch (error) {
                    console.error('Failed to approve withdrawal:', error);
                }
            },

            async rejectWithdrawal(withdrawalId) {
                const reason = prompt('Enter rejection reason:');
                if (!reason) return;

                try {
                    await this.apiRequest(`/api/admin/withdrawals/${withdrawalId}/reject`, {
                        method: 'POST',
                        body: { remarks: reason }
                    });

                    this.showToast('Withdrawal rejected', 'success');
                    this.loadWithdrawals(this.state.currentPage.withdrawals);
                } catch (error) {
                    console.error('Failed to reject withdrawal:', error);
                }
            },

            async viewWithdrawalDetails(withdrawalId) {
                try {
                    const response = await this.apiRequest(`/api/admin/withdrawals/${withdrawalId}`);
                    const withdrawal = response.data.withdrawal;

                    alert(`Withdrawal Details:\n\n` +
                          `User: ${withdrawal.user?.full_name}\n` +
                          `Amount: ₦${this.formatNumber(withdrawal.amount)}\n` +
                          `Fee: ₦${this.formatNumber(withdrawal.platform_fee)}\n` +
                          `Net Amount: ₦${this.formatNumber(withdrawal.net_amount)}\n` +
                          `Method: ${withdrawal.payment_method}\n` +
                          `Status: ${withdrawal.status}\n` +
                          `Bank Details: ${withdrawal.user?.bank_name} - ${withdrawal.user?.account_number}`);
                } catch (error) {
                    console.error('Failed to load withdrawal details:', error);
                }
            },

            // ==================== KYC MANAGEMENT ====================
            async loadKYC(page = 1) {
                try {
                    this.state.currentPage.kyc = page;
                    
                    const status = document.getElementById('kyc-status-filter')?.value || 'pending';
                    const type = document.getElementById('kyc-type-filter')?.value || '';

                    const params = new URLSearchParams({
                        page: page,
                        limit: this.config.ITEMS_PER_PAGE,
                        ...(status !== 'all' && { status }),
                        ...(type && { id_type: type })
                    });

                    const response = await this.apiRequest(`/api/admin/kyc?${params}`);
                    const data = response.data;

                    this.renderKycTable(data.kyc_requests || []);
                    this.renderPagination('kyc-pagination', data.pagination || {}, 'kyc');
                } catch (error) {
                    console.error('Failed to load KYC requests:', error);
                    this.showEmptyState('kyc-table-body', 'Failed to load KYC requests');
                }
            },

            renderKycTable(kycRequests) {
                const tbody = document.getElementById('kyc-table-body');
                if (!tbody) return;

                if (kycRequests.length === 0) {
                    this.showEmptyState('kyc-table-body', 'No KYC requests found');
                    return;
                }

                tbody.innerHTML = kycRequests.map(kyc => `
                    <tr>
                        <td>${kyc._id?.substring(0, 8) || 'N/A'}</td>
                        <td>
                            <strong>${kyc.user?.full_name || 'N/A'}</strong>
                            <br>
                            <small style="color: var(--text-muted);">${kyc.user?.email || 'N/A'}</small>
                        </td>
                        <td>${kyc.id_type || 'N/A'}</td>
                        <td>${kyc.id_number || 'N/A'}</td>
                        <td>${this.formatDate(kyc.createdAt)}</td>
                        <td>
                            <span class="status-badge ${kyc.status || 'pending'}">
                                ${kyc.status || 'Pending'}
                            </span>
                        </td>
                        <td>
                            <button class="btn-sm-info" onclick="admin.viewKycDocuments('${kyc._id}')">
                                <i class="fas fa-file-image"></i> View Documents
                            </button>
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${kyc.status === 'pending' ? `
                                    <button class="btn-sm-primary" onclick="admin.approveKYC('${kyc._id}')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn-sm-danger" onclick="admin.rejectKYC('${kyc._id}')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            async viewKycDocuments(kycId) {
                try {
                    const response = await this.apiRequest(`/api/admin/kyc/${kycId}`);
                    const kyc = response.data.kyc;

                    const content = `
                        <div style="text-align: center;">
                            <h3 style="margin-bottom: 1.5rem; color: var(--text-light);">KYC Documents - ${kyc.user?.full_name}</h3>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                                ${kyc.id_front ? `
                                    <div>
                                        <h4 style="color: var(--text-muted); margin-bottom: 0.8rem;">ID Front</h4>
                                        <img src="${kyc.id_front}" alt="ID Front" style="max-width: 100%; max-height: 300px; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.1);">
                                    </div>
                                ` : ''}
                                
                                ${kyc.id_back ? `
                                    <div>
                                        <h4 style="color: var(--text-muted); margin-bottom: 0.8rem;">ID Back</h4>
                                        <img src="${kyc.id_back}" alt="ID Back" style="max-width: 100%; max-height: 300px; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.1);">
                                    </div>
                                ` : ''}
                                
                                ${kyc.selfie_with_id ? `
                                    <div>
                                        <h4 style="color: var(--text-muted); margin-bottom: 0.8rem;">Selfie with ID</h4>
                                        <img src="${kyc.selfie_with_id}" alt="Selfie with ID" style="max-width: 100%; max-height: 300px; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.1);">
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="proof-details">
                                <div class="proof-detail-item">
                                    <div class="proof-detail-label">User</div>
                                    <div class="proof-detail-value">${kyc.user?.full_name}</div>
                                </div>
                                <div class="proof-detail-item">
                                    <div class="proof-detail-label">Email</div>
                                    <div class="proof-detail-value">${kyc.user?.email}</div>
                                </div>
                                <div class="proof-detail-item">
                                    <div class="proof-detail-label">ID Type</div>
                                    <div class="proof-detail-value">${kyc.id_type}</div>
                                </div>
                                <div class="proof-detail-item">
                                    <div class="proof-detail-label">ID Number</div>
                                    <div class="proof-detail-value">${kyc.id_number}</div>
                                </div>
                                <div class="proof-detail-item">
                                    <div class="proof-detail-label">Status</div>
                                    <div class="proof-detail-value">
                                        <span class="status-badge ${kyc.status}">${kyc.status}</span>
                                    </div>
                                </div>
                                <div class="proof-detail-item">
                                    <div class="proof-detail-label">Submitted</div>
                                    <div class="proof-detail-value">${this.formatDate(kyc.createdAt)}</div>
                                </div>
                            </div>
                            
                            ${kyc.status === 'pending' ? `
                                <div class="modal-actions">
                                    <button class="btn-primary" onclick="admin.approveKYC('${kyc._id}')">
                                        <i class="fas fa-check"></i> Approve KYC
                                    </button>
                                    <button class="btn-secondary" onclick="admin.rejectKYC('${kyc._id}')">
                                        <i class="fas fa-times"></i> Reject KYC
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;

                    document.getElementById('kyc-documents-content').innerHTML = content;
                    this.openModal('kyc-documents-modal');
                } catch (error) {
                    console.error('Failed to load KYC documents:', error);
                    this.showToast('Failed to load KYC documents', 'error');
                }
            },

            async approveKYC(kycId) {
                if (!confirm('Approve this KYC verification?')) return;

                try {
                    await this.apiRequest(`/api/admin/kyc/${kycId}/approve`, {
                        method: 'POST'
                    });

                    this.showToast('KYC approved successfully', 'success');
                    this.closeModal('kyc-documents-modal');
                    this.loadKYC(this.state.currentPage.kyc);
                } catch (error) {
                    console.error('Failed to approve KYC:', error);
                }
            },

            async rejectKYC(kycId) {
                const reason = prompt('Enter rejection reason:');
                if (!reason) return;

                try {
                    await this.apiRequest(`/api/admin/kyc/${kycId}/reject`, {
                        method: 'POST',
                        body: { remarks: reason }
                    });

                    this.showToast('KYC rejected', 'success');
                    this.closeModal('kyc-documents-modal');
                    this.loadKYC(this.state.currentPage.kyc);
                } catch (error) {
                    console.error('Failed to reject KYC:', error);
                }
            },

            // ==================== TRANSACTION MANAGEMENT ====================
            async loadTransactions(page = 1) {
                try {
                    this.state.currentPage.transactions = page;
                    
                    const type = document.getElementById('transaction-type-filter')?.value || '';
                    const startDate = document.getElementById('transaction-start-date')?.value;
                    const endDate = document.getElementById('transaction-end-date')?.value;

                    const params = new URLSearchParams({
                        page: page,
                        limit: this.config.ITEMS_PER_PAGE,
                        ...(type && { type }),
                        ...(startDate && { start_date: startDate }),
                        ...(endDate && { end_date: endDate })
                    });

                    const response = await this.apiRequest(`/api/admin/transactions?${params}`);
                    const data = response.data;

                    this.renderTransactionsTable(data.transactions || []);
                    this.renderPagination('transactions-pagination', data.pagination || {}, 'transactions');
                } catch (error) {
                    console.error('Failed to load transactions:', error);
                    this.showEmptyState('transactions-table-body', 'Failed to load transactions');
                }
            },

            renderTransactionsTable(transactions) {
                const tbody = document.getElementById('transactions-table-body');
                if (!tbody) return;

                if (transactions.length === 0) {
                    this.showEmptyState('transactions-table-body', 'No transactions found');
                    return;
                }

                tbody.innerHTML = transactions.map(txn => `
                    <tr>
                        <td>${txn._id?.substring(0, 8) || 'N/A'}</td>
                        <td>
                            <strong>${txn.user?.full_name || 'N/A'}</strong>
                            <br>
                            <small style="color: var(--text-muted);">${txn.user?.email || 'N/A'}</small>
                        </td>
                        <td>
                            <span class="status-badge ${txn.type}">${txn.type || 'N/A'}</span>
                        </td>
                        <td><strong>₦${this.formatNumber(txn.amount || 0)}</strong></td>
                        <td>${txn.description || 'N/A'}</td>
                        <td>${this.formatDate(txn.createdAt)}</td>
                        <td>
                            <span class="status-badge ${txn.status || 'completed'}">
                                ${txn.status || 'Completed'}
                            </span>
                        </td>
                    </tr>
                `).join('');
            },

            // ==================== REPORTS ====================
            async loadReports() {
                try {
                    const response = await this.apiRequest('/api/admin/reports/summary');
                    const data = response.data;

                    this.createRevenueChart(data.revenue_data || []);
                    this.createUserGrowthChart(data.user_growth || []);
                } catch (error) {
                    console.error('Failed to load reports:', error);
                }
            },

            async generateReport() {
                const type = document.getElementById('report-type')?.value || 'daily';
                let startDate, endDate;

                if (type === 'custom') {
                    startDate = document.getElementById('report-start-date')?.value;
                    endDate = document.getElementById('report-end-date')?.value;
                    
                    if (!startDate || !endDate) {
                        this.showToast('Please select date range', 'error');
                        return;
                    }
                }

                try {
                    const params = new URLSearchParams({
                        type,
                        ...(startDate && { start_date: startDate }),
                        ...(endDate && { end_date: endDate })
                    });

                    const response = await this.apiRequest(`/api/admin/reports/generate?${params}`);
                    
                    // Create download link for the report
                    const blob = new Blob([JSON.stringify(response.data, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `report-${type}-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);

                    this.showToast('Report generated successfully', 'success');
                } catch (error) {
                    console.error('Failed to generate report:', error);
                }
            },

            // ==================== SETTINGS ====================
            async loadSettings() {
                try {
                    const response = await this.apiRequest('/api/admin/settings');
                    const settings = response.data.settings || {};

                    // Update settings display
                    document.getElementById('platform-fee').textContent = `${settings.platform_fee || 5}%`;
                    document.getElementById('referral-commission').textContent = `${settings.referral_commission || 15}%`;
                    document.getElementById('min-investment').textContent = `₦${this.formatNumber(settings.min_investment || 3500)}`;
                    document.getElementById('min-deposit').textContent = `₦${this.formatNumber(settings.min_deposit || 500)}`;
                    document.getElementById('min-withdrawal').textContent = `₦${this.formatNumber(settings.min_withdrawal || 1000)}`;
                    
                    const platformStatus = document.getElementById('platform-status');
                    if (settings.platform_active) {
                        platformStatus.textContent = 'Active';
                        platformStatus.className = 'status-badge active';
                    } else {
                        platformStatus.textContent = 'Maintenance';
                        platformStatus.className = 'status-badge suspended';
                    }
                } catch (error) {
                    console.error('Failed to load settings:', error);
                }
            },

            editPlatformFee() {
                const content = `
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Platform Fee (%)</label>
                        <input type="number" class="search-input" style="width: 100%;" id="setting-value" min="0" max="100" step="0.1" value="5" required>
                    </div>
                `;
                
                document.getElementById('setting-form-content').innerHTML = content;
                document.getElementById('edit-setting-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.saveSetting('platform_fee', document.getElementById('setting-value').value);
                };
                
                this.openModal('edit-setting-modal');
            },

            editReferralCommission() {
                const content = `
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Referral Commission (%)</label>
                        <input type="number" class="search-input" style="width: 100%;" id="setting-value" min="0" max="100" step="0.1" value="15" required>
                    </div>
                `;
                
                document.getElementById('setting-form-content').innerHTML = content;
                document.getElementById('edit-setting-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.saveSetting('referral_commission', document.getElementById('setting-value').value);
                };
                
                this.openModal('edit-setting-modal');
            },

            editMinInvestment() {
                const content = `
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Minimum Investment (₦)</label>
                        <input type="number" class="search-input" style="width: 100%;" id="setting-value" min="100" step="100" value="3500" required>
                    </div>
                `;
                
                document.getElementById('setting-form-content').innerHTML = content;
                document.getElementById('edit-setting-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.saveSetting('min_investment', document.getElementById('setting-value').value);
                };
                
                this.openModal('edit-setting-modal');
            },

            editMinDeposit() {
                const content = `
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Minimum Deposit (₦)</label>
                        <input type="number" class="search-input" style="width: 100%;" id="setting-value" min="100" step="100" value="500" required>
                    </div>
                `;
                
                document.getElementById('setting-form-content').innerHTML = content;
                document.getElementById('edit-setting-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.saveSetting('min_deposit', document.getElementById('setting-value').value);
                };
                
                this.openModal('edit-setting-modal');
            },

            editMinWithdrawal() {
                const content = `
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Minimum Withdrawal (₦)</label>
                        <input type="number" class="search-input" style="width: 100%;" id="setting-value" min="100" step="100" value="1000" required>
                    </div>
                `;
                
                document.getElementById('setting-form-content').innerHTML = content;
                document.getElementById('edit-setting-form').onsubmit = (e) => {
                    e.preventDefault();
                    this.saveSetting('min_withdrawal', document.getElementById('setting-value').value);
                };
                
                this.openModal('edit-setting-modal');
            },

            async saveSetting(key, value) {
                try {
                    await this.apiRequest('/api/admin/settings', {
                        method: 'PUT',
                        body: { [key]: value }
                    });

                    this.showToast('Setting updated successfully', 'success');
                    this.closeModal('edit-setting-modal');
                    this.loadSettings();
                } catch (error) {
                    console.error('Failed to save setting:', error);
                }
            },

            async togglePlatformStatus() {
                const currentStatus = document.getElementById('platform-status').textContent === 'Active';
                const newStatus = !currentStatus;

                if (!confirm(`Are you sure you want to ${newStatus ? 'activate' : 'put in maintenance'} the platform?`)) {
                    return;
                }

                try {
                    await this.apiRequest('/api/admin/settings/platform-status', {
                        method: 'PUT',
                        body: { platform_active: newStatus }
                    });

                    this.showToast(`Platform ${newStatus ? 'activated' : 'put in maintenance'}`, 'success');
                    this.loadSettings();
                } catch (error) {
                    console.error('Failed to toggle platform status:', error);
                }
            },

            // ==================== PROOF IMAGE VIEWER ====================
            viewProofImage(imageUrl, type, amount, userName, date) {
                document.getElementById('proof-image').src = imageUrl;
                document.getElementById('zoom-level').textContent = '100%';
                this.state.zoomLevel = 100;
                document.getElementById('proof-image').style.transform = 'scale(1)';

                const details = `
                    <div class="proof-detail-item">
                        <div class="proof-detail-label">Type</div>
                        <div class="proof-detail-value">${type}</div>
                    </div>
                    <div class="proof-detail-item">
                        <div class="proof-detail-label">Amount</div>
                        <div class="proof-detail-value">${amount}</div>
                    </div>
                    <div class="proof-detail-item">
                        <div class="proof-detail-label">User</div>
                        <div class="proof-detail-value">${userName}</div>
                    </div>
                    <div class="proof-detail-item">
                        <div class="proof-detail-label">Date</div>
                        <div class="proof-detail-value">${date}</div>
                    </div>
                `;

                document.getElementById('proof-details').innerHTML = details;
                this.openModal('proof-image-modal');
            },

            zoomIn() {
                if (this.state.zoomLevel < 300) {
                    this.state.zoomLevel += 25;
                    this.updateZoom();
                }
            },

            zoomOut() {
                if (this.state.zoomLevel > 25) {
                    this.state.zoomLevel -= 25;
                    this.updateZoom();
                }
            },

            updateZoom() {
                const image = document.getElementById('proof-image');
                const zoomLevel = document.getElementById('zoom-level');
                
                if (image && zoomLevel) {
                    image.style.transform = `scale(${this.state.zoomLevel / 100})`;
                    zoomLevel.textContent = `${this.state.zoomLevel}%`;
                }
            },

            downloadProof() {
                const image = document.getElementById('proof-image');
                const link = document.createElement('a');
                link.href = image.src;
                link.download = `proof-${new Date().toISOString().split('T')[0]}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },

            // ==================== BROADCAST ====================
            openBroadcastModal() {
                this.openModal('broadcast-modal');
            },

            // ==================== UTILITY FUNCTIONS ====================
            setupEventListeners() {
                // Report type change listener
                const reportType = document.getElementById('report-type');
                if (reportType) {
                    reportType.addEventListener('change', function() {
                        const customRange = document.getElementById('custom-date-range');
                        if (this.value === 'custom') {
                            customRange.style.display = 'flex';
                        } else {
                            customRange.style.display = 'none';
                        }
                    });
                }

                // Broadcast form submission
                const broadcastForm = document.getElementById('broadcast-form');
                if (broadcastForm) {
                    broadcastForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        await this.sendBroadcast();
                    });
                }
            },

            async sendBroadcast() {
                const recipients = document.getElementById('broadcast-recipients').value;
                const subject = document.getElementById('broadcast-subject').value;
                const message = document.getElementById('broadcast-message').value;

                try {
                    await this.apiRequest('/api/admin/broadcast', {
                        method: 'POST',
                        body: { recipients, subject, message }
                    });

                    this.showToast('Broadcast sent successfully', 'success');
                    this.closeModal('broadcast-modal');
                } catch (error) {
                    console.error('Failed to send broadcast:', error);
                }
            },

            setupTabSwitching() {
                const tabs = document.querySelectorAll('.admin-nav a');
                tabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tabId = tab.getAttribute('onclick').match(/'(.*?)'/)[1];
                        this.switchTab(tabId);
                    });
                });
            },

            switchTab(tabId) {
                // Hide all tabs
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Remove active class from all nav items
                document.querySelectorAll('.admin-nav a').forEach(item => {
                    item.classList.remove('active');
                });

                // Show selected tab
                const tabElement = document.getElementById(`${tabId}-tab`);
                if (tabElement) {
                    tabElement.classList.add('active');
                    this.state.currentTab = tabId;

                    // Set active nav item
                    const navItem = document.querySelector(`.admin-nav a[onclick*="${tabId}"]`);
                    if (navItem) {
                        navItem.classList.add('active');
                    }

                    // Load tab data
                    this.loadTabData(tabId);
                }
            },

            loadTabData(tabId) {
                switch(tabId) {
                    case 'overview':
                        this.loadOverviewStats();
                        break;
                    case 'users':
                        this.loadUsers();
                        break;
                    case 'investments':
                        this.loadInvestments();
                        break;
                    case 'deposits':
                        this.loadDeposits();
                        break;
                    case 'withdrawals':
                        this.loadWithdrawals();
                        break;
                    case 'kyc':
                        this.loadKYC();
                        break;
                    case 'transactions':
                        this.loadTransactions();
                        break;
                    case 'reports':
                        this.loadReports();
                        break;
                    case 'settings':
                        this.loadSettings();
                        break;
                }
            },

            switchUserTab(tabId) {
                // Hide all user tabs
                document.querySelectorAll('.user-tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Remove active class from all user tab buttons
                document.querySelectorAll('.user-tab').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Show selected tab
                const tabElement = document.getElementById(`user-${tabId}-tab`);
                if (tabElement) {
                    tabElement.classList.add('active');
                }

                // Set active button
                const buttons = document.querySelectorAll('.user-tab');
                buttons.forEach(btn => {
                    if (btn.textContent.includes(tabId.charAt(0).toUpperCase() + tabId.slice(1))) {
                        btn.classList.add('active');
                    }
                });
            },

            renderPagination(containerId, pagination, type) {
                const container = document.getElementById(containerId);
                if (!container) return;

                const { current_page, total_pages, total_items } = pagination;
                
                if (total_pages <= 1) {
                    container.style.display = 'none';
                    return;
                }

                container.style.display = 'flex';

                let html = '';

                // Previous button
                html += `
                    <button class="pagination-button ${current_page === 1 ? 'disabled' : ''}" 
                            ${current_page === 1 ? 'disabled' : ''}
                            onclick="admin.load${type.charAt(0).toUpperCase() + type.slice(1)}(${current_page - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;

                // Page numbers
                const maxVisible = 5;
                let startPage = Math.max(1, current_page - Math.floor(maxVisible / 2));
                let endPage = Math.min(total_pages, startPage + maxVisible - 1);

                if (endPage - startPage + 1 < maxVisible) {
                    startPage = Math.max(1, endPage - maxVisible + 1);
                }

                for (let i = startPage; i <= endPage; i++) {
                    html += `
                        <button class="pagination-button ${i === current_page ? 'active' : ''}"
                                onclick="admin.load${type.charAt(0).toUpperCase() + type.slice(1)}(${i})">
                            ${i}
                        </button>
                    `;
                }

                // Next button
                html += `
                    <button class="pagination-button ${current_page === total_pages ? 'disabled' : ''}"
                            ${current_page === total_pages ? 'disabled' : ''}
                            onclick="admin.load${type.charAt(0).toUpperCase() + type.slice(1)}(${current_page + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;

                container.innerHTML = html;
            },

            // ==================== CHARTS ====================
            createGrowthChart(data) {
                const ctx = document.getElementById('growth-chart');
                if (!ctx) return;

                // Destroy existing chart
                if (this.state.charts.growth) {
                    this.state.charts.growth.destroy();
                }

                const labels = data.map(item => new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                const userData = data.map(item => item.new_users || 0);
                const investmentData = data.map(item => item.investments || 0);
                const depositData = data.map(item => item.deposits || 0);

                this.state.charts.growth = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'New Users',
                                data: userData,
                                borderColor: this.config.CHART_COLORS.primary,
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Investments',
                                data: investmentData,
                                borderColor: this.config.CHART_COLORS.success,
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Deposits',
                                data: depositData,
                                borderColor: this.config.CHART_COLORS.info,
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#94a3b8'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: {
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });
            },

            createRevenueChart(data) {
                const ctx = document.getElementById('revenue-chart');
                if (!ctx) return;

                // Destroy existing chart
                if (this.state.charts.revenue) {
                    this.state.charts.revenue.destroy();
                }

                const labels = data.map(item => new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                const revenueData = data.map(item => item.revenue || 0);

                this.state.charts.revenue = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Daily Revenue',
                            data: revenueData,
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            borderColor: this.config.CHART_COLORS.primary,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#94a3b8'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: {
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return '₦' + value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });
            },

            createUserGrowthChart(data) {
                const ctx = document.getElementById('user-growth-chart');
                if (!ctx) return;

                // Destroy existing chart
                if (this.state.charts.userGrowth) {
                    this.state.charts.userGrowth.destroy();
                }

                const labels = data.map(item => new Date(item.date).toLocaleDateString('en-US', { month: 'short' }));
                const totalUsers = data.map(item => item.total_users || 0);
                const newUsers = data.map(item => item.new_users || 0);

                this.state.charts.userGrowth = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Total Users',
                                data: totalUsers,
                                borderColor: this.config.CHART_COLORS.success,
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 3,
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'New Users',
                                data: newUsers,
                                borderColor: this.config.CHART_COLORS.primary,
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: '#94a3b8'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: {
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });
            },

            // ==================== UI HELPERS ====================
            updateStatCard(elementId, value) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = value;
                }
            },

            updateBadge(elementId, count) {
                const element = document.getElementById(elementId);
                if (element) {
                    if (count > 0) {
                        element.textContent = count > 99 ? '99+' : count;
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                }
            },

            showEmptyState(containerId, message) {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="100%" style="text-align: center; padding: 3rem;">
                                <div class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <p>${message}</p>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            },

            showLoadingSpinner(show) {
                const spinner = document.getElementById('loading-spinner');
                if (spinner) {
                    spinner.style.display = show ? 'flex' : 'none';
                }
            },

            showToast(message, type = 'info') {
                const container = document.getElementById('toast-container');
                if (!container) return;

                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                let icon = 'info-circle';
                if (type === 'success') icon = 'check-circle';
                else if (type === 'error') icon = 'exclamation-circle';
                else if (type === 'warning') icon = 'exclamation-triangle';

                toast.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                `;

                container.appendChild(toast);

                // Remove after 3 seconds
                setTimeout(() => {
                    if (toast.parentNode === container) {
                        container.removeChild(toast);
                    }
                }, 3000);
            },

            openModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            },

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            },

            formatNumber(num) {
                return Number(num).toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            },

            formatDate(dateString) {
                if (!dateString) return 'N/A';
                
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
        };

        // Initialize the admin dashboard
        window.addEventListener('DOMContentLoaded', function() {
            admin.init();
        });
    </script>
</body>
</html>
